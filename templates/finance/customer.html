{% extends "base.html" %}
{% load static%}
{% block title%} Customer {% endblock%}
{% block content %}
<div class="finance d-flex">
    <div class="px-2 main-content ">
        <div class='row mt-2'>
            <div class='col'>
                <div class='img mt-2 d-flex align-items-center flex-column'>
                    <img class='rounded-circle'width='100px'  src="{% static 'assets/avatar.png' %}"/>
                   <div class="mt-2">
                        <table>
                            <tr>
                                <td>Name</td>
                                <td class='px-3'>{{customer.name}}</td>
                            </tr>
                            <tr>
                                <td>Phone number</td>
                                <td class='px-3'>{{customer.phone_number}}</td>
                            </tr>
                            <tr>
                                <td>Email</td>
                                <td class='px-3'>{{customer.email}}</td>
                            </tr>
                        </table>
                   </div>
                </div>
            </div>
            <div class='col'>
                <div class='card'>
                    <div class='card-body rounded'>
                        <h6>Account</h6>
                        <h6 class='text-center text-light text-muted'>{{account.balance}}</h6>
                        <h6 class='text-center text-light text-muted'></h6>
                    </div>
                </div>
                <div class='card mt-2'>
                    <div class='card-body rounded'>
                        <h6>Invoice Count</h6>
                    </div>
                </div>
            </div>
        </div>
        <div class="finance-navbar mt-2">
            <nav class="d-flex justify-content-between align-items-center p-2 border rounded">
                <div class="d-flex w-100 justify-content-between">
                    <div class='mt-1'>
                        <a href='{% url 'finance:invoice'%}' class='btn btn-primary btn-sm'>
                            <i class='bx bx-left-arrow-alt'></i>
                        </a>
                    </div>
                    <div class='px-1 d-flex'> 
                        <form method="get">
                            <input type="search" name='search_query' type="text" class='form-control' value='{{search_query}}' placeholder='search...'/>
                        </form>
                        <span class='px-1'></span>
                        <form method='get' class='d-flex'>
                            <select name='q' class='form-control' value="{{q}}">
                                <option value=''>All</option>
                                <option value='Paid'>Paid</option>
                                <option value='Partial'>Partial</option>
                            </select>
                            <span class='px-1'></span>
                            <button class='btn btn-light btn-sm'>
                                <i class='bx bx-filter'></i>
                            </button>
                        </form>
                    </div>
                </div>
            </nav>
        </div>
        <div class='mt-3 mb-3'>
            <div class='mt-2'>Invoice List</div>
        </div>
        
        <table class="table border rounded table-responsive table-sm p-2">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Invoice #</th>
                    <th>Amount Paid</th>
                    <th>Amount Due</th>
                    <th>Amount</th>
                    <th>Processed by</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                    <tr style='color: #6c757d;'>
                        {% if invoice.payment_status == 'Paid'%}
                            <td><small>{{invoice.issue_date}}</small></td>
                            <td><small>#{{invoice.invoice_number}}</small></td>
                            <td>{{invoice.amount_paid}}</td>
                            <td>{{invoice.amount_due}}</td>
                            <td>${{invoice.amount}}</td>
                            <td>{{invoice.user.username}}</td>
                            <td>
                                <span>
                                    <a href="{% url 'finance:invoice_preview' invoice.id %}" class='btn btn-light btn-sm'>
                                        <i class='bx bx-show'></i>
                                    </a>
                                </span>  
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <button class="btn btn-light btn-sm text-success" disabled>
                                            <i class='bx bx-rectangle'></i>
                                        </button>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <a href='' class="btn btn-light btn-sm text-success">
                                            <i class='bx bxl-gmail'></i>
                                        </a>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <a href='' class="btn btn-light btn-sm text-success">
                                            <i class='bx bxl-whatsapp'></i>
                                        </a>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <button class="btn btn-light btn-sm text-danger">
                                            <i class='bx bx-trash'></i>
                                        </button>
                                    {% endif %}
                                </span>  
                            </td>
                        {% else %}
                            <td class='text-danger'><small>{{invoice.issue_date}}</small></td>
                            <td class='text-danger'><small>#{{invoice.invoice_number}}</small></td>
                            <td class='text-danger'>{{invoice.amount_paid}}</td>
                            <td class='text-danger'>{{invoice.amount_due}}</td>
                            <td class='text-danger'>${{invoice.amount}}</td>
                            <td class='text-danger'>{{invoice.user.username}}</td>
                            <td>
                                <span>
                                    <a href="{% url 'finance:invoice_preview' invoice.id %}" class='btn btn-light btn-sm'>
                                        <i class='bx bx-show'></i>
                                    </a>
                                </span>  
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <button class="btn btn-light btn-sm text-success">
                                            <i class='bx bx-right-arrow'></i>
                                        </button>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <a href='' class="btn btn-light btn-sm text-success">
                                            <i class='bx bxl-gmail'></i>
                                        </a>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <a href='' class="btn btn-light btn-sm text-success">
                                            <i class='bx bxl-whatsapp'></i>
                                        </a>
                                    {% endif %}
                                </span>
                                <span>
                                    {% if request.user.role == 'admin' %}
                                        <button class="btn btn-light btn-sm text-danger">
                                            <i class='bx bx-trash'></i>
                                        </button>
                                    {% endif %}
                                </span>  
                            </td>
                        {% endif %}
                    </tr>
                {% endfor %}
            </tbody>  
        </table>
    </div>

    <div class="invoice-modal hidden">
        <div class="modal-content">
            {% include 'finance/expenses/add_expense.html'%}
        </div>
    </div>
    <div class="overlay hidden"></div>
</div>

<script type="text/javascript">
    const modal = document.querySelector('.invoice-modal')
    const overlay = document.querySelector('.overlay')
    const expButton = document.querySelector('#id_expense_button')
    
    expButton.addEventListener(
        'click', ()=>{
            modal.classList.remove('hidden')
            overlay.classList.remove('hidden')
        }
    )
    
    document.querySelector('#btn-close').addEventListener(
        'click', ()=>{
            modal.classList.add('hidden')
            overlay.classList.add('hidden')
        }
    ) 
</script>
{% endblock content %}
